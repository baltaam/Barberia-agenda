generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- 1. NEGOCIOS (Tenants) ---
model Tenant {
  id         String  @id @default(uuid())
  name       String
  slug       String  @unique
  themeColor String  @default("#000000")
  category   String? @default("Servicio")
  address    String?
  phone      String?

  // üî• AQU√ç EST√ÅN LOS NUEVOS CAMPOS DE HORARIOS üî•
  openingHour   Int     @default(9) // Hora de apertura (ej: 9 para las 09:00)
  closingHour   Int     @default(18) // Hora de cierre (ej: 18 para las 18:00)
  closedDays    String  @default("[0]") // D√≠as cerrados en formato texto (0=Dom, 1=Lun... 6=Sab)
  mpAccessToken String?

  professionals Professional[]
  services      Service[]
  customers     Customer[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// --- 2. PROFESIONALES ---
model Professional {
  id           String        @id @default(uuid())
  name         String
  tenantId     String
  tenant       Tenant        @relation(fields: [tenantId], references: [id])
  appointments Appointment[]
  blockedDates BlockedDate[]
}

// --- 3. SERVICIOS ---
model Service {
  id           String        @id @default(uuid())
  name         String
  price        Int
  durationMin  Int
  tenantId     String
  tenant       Tenant        @relation(fields: [tenantId], references: [id])
  appointments Appointment[]
}

// --- 4. CLIENTES ---
model Customer {
  id           String        @id @default(uuid())
  name         String
  email        String
  phone        String?
  tenantId     String
  tenant       Tenant        @relation(fields: [tenantId], references: [id])
  appointments Appointment[]
}

// --- 5. TURNOS ---
model Appointment {
  id             String       @id @default(uuid())
  startTime      DateTime
  endTime        DateTime
  status         String       @default("PENDING")
  paymentStatus  String       @default("PENDING") // PENDING, APPROVED, REJECTED
  paymentId      String? // El n√∫mero de recibo de MP
  professionalId String
  professional   Professional @relation(fields: [professionalId], references: [id])
  serviceId      String
  service        Service      @relation(fields: [serviceId], references: [id])
  customerId     String
  customer       Customer     @relation(fields: [customerId], references: [id])
}

// --- 6. VACACIONES Y BLOQUEOS ---
model BlockedDate {
  id             String       @id @default(uuid())
  date           DateTime
  reason         String
  professionalId String
  professional   Professional @relation(fields: [professionalId], references: [id])
}
